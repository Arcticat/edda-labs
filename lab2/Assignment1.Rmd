---
title: "Assignment2"
author: "Jiacheng Lu"
date: "2020/2/29"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Exercise 5. Expenditure on criminal activities 

The data in expensescrime.txt were obtained to determine factors related to state expenditures on criminal activities (courts, police, etc.) The variables are: state (indicating the state in the USA), expend (state expenditures on criminal activities in $1000), bad (crime rate per 100000), crime (number of persons under criminal supervision), lawyers (number of lawyers in the state), employ (number of persons employed in the state) and pop (population of the state in 1000). In the regression analysis, take expend as response variable and bad, crime, lawyers, employ and pop as explanatory variables. 

##### a) Make some graphical summaries of the data. Investigate the problem of potential and inﬂuence points, and the problem of collinearity. 
```{r}
expensescrime=read.table(file="expensescrime.txt",header=TRUE)
for (i in c(2,3,4,5,6,7)) hist(expensescrime[,i],main=names(expensescrime[i]))
plot(expensescrime[,c(2,3,4,5,6,7)])
par(mfrow=c(2,3))
```
From the plot we can find potential points for each variable. For bad:336.2(CA) & 370.1(TX); For lawyers:82001(CA)&72575(NY);For employ: 118149(CA) & 111518(NY); For pop: 27663(CA).

```{r}
expendbadlm=lm(expend~bad,data=expensescrime)
expendcrimelm=lm(expend~crime,data=expensescrime)
expendlawyerslm=lm(expend~lawyers,data=expensescrime)
expendemploylm=lm(expend~employ,data=expensescrime)
expendpoplm=lm(expend~pop,data=expensescrime)
round(cooks.distance(expensescrimelm),2)
plot(cooks.distance(expensescrimelm),type="b",main="Cook's distances")
```
For influence points, we check the Cook's distance, from the plot we can see that there are four. No.5(CA) & No.8(DC) & No.35(NY) & No.44(TX).

```{r}
library(car)
vif(expensescrimelm)
round(cor(expensescrime[,c(3,4,5,6,7)]),2)
pairs(expensescrime[,c(3,4,5,6,7)])

```
From both the scatter plot and pairwise linear correlation and the vif, bad and pop (correlation value=0.92), lawyers and employ (correlation value=0.97), lawyers and pop(correlation value=0.93), employ and pop (correlation value=0.97), so crime and  lawyers and employ and pop are collinear.


##### b) Fit a linear regression model to the data. Use both the step-up and the step-down method to ﬁnd the best model. If step-up and step-down yield two diﬀerent models, choose one and motivate your choice.

First, in the step-up method, we starts with fitting all p possible simple linear regression models:
$Y_{n}=\beta_{0}+\beta{1}X_{nj}+e_{n}$
To save pages, Only parts of summary are shown.
```{r}
summary(lm(expend~bad,data=expensescrime))[8]
summary(lm(expend~crime,data=expensescrime))[8]
summary(lm(expend~lawyers,data=expensescrime))[8]
summary(lm(expend~employ,data=expensescrime))[8]
summary(lm(expend~pop,data=expensescrime))[8]
```
The employ yields the highest $R^{2}$ increase.
```{r}
summary(lm(expend~employ+bad,data=expensescrime))[8]
summary(lm(expend~employ+crime,data=expensescrime))[8]
summary(lm(expend~employ+lawyers,data=expensescrime))[8]
summary(lm(expend~employ+pop,data=expensescrime))[8]
```
Adding bad or crime or pop yields insignificant explanatory varibles. Therefore stop. The resulting model of the step-up method is $expend=-110.7+0.02971*employ+0.02686*lawyers$.

```{r}
summary(lm(expend~bad+crime+lawyers+employ+pop,data=expensescrime))[8]
summary(lm(expend~bad+lawyers+employ+pop,data=expensescrime))[8]
summary(lm(expend~bad+lawyers+employ,data=expensescrime))[8]
summary(lm(expend~lawyers+employ,data=expensescrime))[8]
```
In the step-down method, we remove variables whose p-value is larger than 0.05, we stop after remove bad because remaining variables are significant. the model is the same as the model of step-up model.

##### c) Check the model assumptions by using relevant diagnostic  tools.
The model is $expend=-110.7+0.02971*employ+0.02686*lawyers$.
```{r}
employ=expensescrime$employ
expend=expensescrime$expend
lawyers=expensescrime$lawyers
expendemploylawyerslm=lm(expend~employ+lawyers)
plot(residuals(expendemploylawyerslm),employ,main="plot of residuals against employ")
plot(residuals(expendemploylawyerslm),lawyers,main="plot of residuals against lawyers")
x=residuals(lm(employ+lawyers~expensescrime$bad+expensescrime$crime+expensescrime$pop))
y=residuals(lm(expend~expensescrime$bad+expensescrime$crime+expensescrime$pop))
plot(x,y,main="Added variable plot for employ+lawyers")
plot(residuals(expendemploylawyerslm),expensescrime$bad,main="plot of residuals against bad")
plot(residuals(expendemploylawyerslm),expensescrime$crime,main="plot of residuals against crime")
plot(residuals(expendemploylawyerslm),expensescrime$pop,main="plot of residuals against pop")
plot(residuals(expendemploylawyerslm),expend,main="plot of residuals against expend")
plot(fitted(expendemploylawyerslm),residuals(expendemploylawyerslm))
qqnorm(residuals(expendemploylawyerslm))
```
From the above plots we can see that spread of the residuals against employ and the residuals against lawyers are alike. The normal  Q-Q plot of residuals doesn't show normal distribution.  JHowever, plot residuals against Y shows some pattern of decrease. From a), we already know that there is a problem of collinearity between lawyers and employ. Compare with other models, expend~employ has less variables and only a slightly lower value of R-squared.
The model is $expend=-116.7+0.046811*employ$.
```{r}
vif(expendemploylawyerslm)
summary(lm(expend~lawyers,data=expensescrime))[8]
summary(lm(expend~employ,data=expensescrime))
```

