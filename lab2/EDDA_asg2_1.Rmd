---
title: "Edda_asg2"
author: "Chenghan Song"
date: "2020/3/5"
output:
  html_document: default
  pdf_document: default
---
```{r, include=FALSE}
options(tinytex.verbose = TRUE)
```


## Exercise 1
##### a)
We assign combine levels ($i$,$j$) of the factors to a random set of N units
```{r}
I=3; J=2; N=3
rbind(rep(1:I,each=N*J),rep(1:J,N*I),sample(1:(N*I*J)))
```
##### b)
```{r}
breadata=read.table(file="bread.txt",header=TRUE);par(mfrow=c(1,2))
boxplot(hours~environment,data=breadata, main="box plot of hours-environment")
boxplot(hours~humidity, data=breadata,main="box plot of hours-humidity")
interaction.plot(breadata$environment,breadata$humidity,breadata$hours, main="interaction plot(humidity fixed)")
interaction.plot(breadata$humidity,breadata$environment,breadata$hours, main="interaction plot(environment fixed)")
```

The lines in the interaction plots are unparallel, thus we can assume that there are interactions between temperature and humidity. 

##### c)
```{r}
breadaov=lm(hours~environment*humidity, data = breadata); anova(breadaov)
```
$H_0$:$α_i$ = 0 for all $i$: The temperature does not have a main effect on the time of decay

$H_0$: $β_j$ = 0 for all $j$: The humidity does not have a main effect on the time of decay

$H_0$: $γ_{ij}$ = 0 for all ($i$, $j$): Temperature and humidity do not have interaction effects on the time of decay

The p-value for testing $H_0$:$α_i$ = 0 for all $i$ is 2.461e-10, hence $H_0$ is rejected; for $H_0$: $β_j$ = 0 for all $j$ is 4.316e-06, hence $H_0$ is rejected; for $H_0$: $γ_{ij}$ = 0 for all ($i$, $j$) is 3.705e-07, hence $H_0$ is rejected. So both temperature and humidity have main effects and there are also interactions between two factors.

```{r}
summary(breadaov)
```

$H_0$ for the interaction of intermediate environment and wet humidity: there is no interaction effect of intermediate environment and wet humidity. The p-value is 7.23e-06, therefore we reject $H_0$ and conclude that there is a significant interaction between intermediate temperature and wet humidity.

$H_0$ for the interaction of warm environment and wet humidity: there is no interaction effect of warm environment and wet humidity. The p-value is 1.07e-07, therefore we reject $H_0$ and conclude that there is a significant interaction between warm temperature and wet humidity.

##### d)
This is not a good question. Because the interaction effects between two factors are significant. We can not compare the influence of the first and second factor when there are interactions between them.

##### e)
```{r}
par(mfrow=c(1,2));qqnorm(residuals(breadaov), main="QQ-plot residuals"); plot(fitted(breadaov),residuals(breadaov), main="residuals VS fitted values")
```

From the QQ-Plot we can see that the residuals are not normally distributed. 

The spread in the residuals seems to be bigger for some certain fitted values. Due to the spread in the residuals should not change systematically with any variable, in particular not with the fitted values, there might be some outliers.

## Exercise 3
##### a)
```{r}
cow=read.table(file="cow.txt",header=TRUE)
cow$id=factor(cow$id); cow$per=factor(cow$per)
aovcow=lm(milk~treatment+id,data=cow); anova(aovcow)
par(mfrow=c(1,2));plot(aovcow,1);plot(aovcow,2)
```

$H_0$: the type of feedingstuffs does not influence milk production

The p-value for testing $H_0$ is 0.8281, thus we fail to reject $H_0$, the type of feedingstuffs does not have an effect on milk production. From the plot above, the residuals do not seem to deviate significantly from normal.

However, an ordinary "mixed effects" model is not suitable in this case where the assumption of "exchangebility" may fail. Cows may be happy with or bored at feedingstuff, then a block design is invalid.

##### b)
```{r}
cowlm=lm(milk~treatment+per+id,data=cow); anova(cowlm);summary(cowlm)
```

```{r}
library("lme4")
cowlmer=lmer(milk~treatment+order+per+(1|id),REML=FALSE, data = cow);summary(cowlmer)
cowlmer1 = lmer(milk~order+per+(1|id),REML=FALSE, data = cow)
anova(cowlmer,cowlmer1)
```

$H_0$: the type of feedingstuffs does not influence milk production

In fixed effects analysis, the p-value for testing $H_0$ is 1.349e-06, thus $H_0$ is rejected, the type of feedingstuffs influences milk production

In mixed effects analysis, the p-value for testing $H_0$ is 0.446, thus we accept $H_0$, the type of feedingstuffs does not influence milk production

The estimated treatment and period effects under fixed effects of mixed effects analysis are identical to those in fixed effects analysis.

##### c)
```{r}
attach(cow)
t.test(milk[treatment=="A"],milk[treatment=="B"],paired=TRUE)
```

The paired-sample t-test produces a invalid test for a difference in milk production, because repeated measures may not be exchangeable because of time effect: Cows may mature or get older and learning effect: Cows may be happy with or bored at feedingstuff.

The p-value for treatment is identical to the one of the previous "fixed effects" obtained in a) (the order of the treatments was ignored). They are compatible because in the case of two repeated measurements, $t^2$ value for paired t-test is identical to the $F$ value of the repeated measures ANOVA.
